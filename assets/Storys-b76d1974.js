import{_ as g,J as x,r as u,o as p,c as m,f as t,j as _,D as f,s as M,q as w,d as c,L as k,y as L,z as C,a3 as V,b as $,k as D,p as T,t as b}from"./index-f9d242ac.js";import{C as U}from"./ckeditor-118e8c26.js";import{P as I}from"./Pagination-6b6780b9.js";import{m as P}from"./messageStore-2b7ed7f6.js";const F={mixins:[x],data(){return{modal:{},tempStory:{},create_at:"",shortcuts:[{text:"Today",value:new Date},{text:"Yesterday",value:()=>{const s=new Date;return s.setTime(s.getTime()-3600*1e3*24),s}},{text:"A week ago",value:()=>{const s=new Date;return s.setTime(s.getTime()-3600*1e3*24*7),s}}],inputValue:"",dynamicTags:["NBA","SPORT","NEWS"],inputVisible:!1,InputRef:null,editor:U,editorConfig:{},Loading_small:!1}},props:{story:{type:Object,default(){return{}}}},watch:{story(){this.tempStory=this.story,this.create_at=new Date(this.tempStory.create_at*1e3),this.tempStory.images||(this.tempStory.images=[])},create_at(){this.tempStory.create_at=Math.floor(new Date(this.create_at)/1e3)}},methods:{uploadFile(){this.Loading_small=!0;const s=this.$refs.fileInput.files[0],o=new FormData;o.append("file-to-upload",s);const i="https://vue3-course-api.hexschool.io/api/william-api/admin/upload";this.$http.post(i,o).then(n=>{console.log(n),n.data.success&&(this.tempStory.imageUrl=n.data.imageUrl,this.Loading_small=!1)})},handleClose(s){this.dynamicTags.splice(this.dynamicTags.indexOf(s),1)},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.InputRef.focus()})},handleInputConfirm(){this.inputValue&&this.dynamicTags.push(this.inputValue),this.inputVisible=!1,this.inputValue=""}}},a=s=>(L("data-v-e7607e83"),s=s(),C(),s),B={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},E={class:"modal-content border-0"},A=a(()=>t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"新增文章")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),R={class:"modal-body"},O={class:"row"},j={class:"col-sm-4"},z={class:"mb-3"},H=a(()=>t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1)),q={class:"mb-3"},J={for:"customFile",class:"form-label"},W=["src","alt"],Y={class:"col-sm-8"},G={class:"d-flex flex-column gap-3"},K={class:"d-flex flex-column flex-md-row align-items-start gap-1"},Q=a(()=>t("p",null,"新增日期",-1)),X=a(()=>t("label",{for:"title",class:"form-label"},"標題",-1)),Z={class:"row gx-2"},tt={class:"mb-3 col-md-6"},et=a(()=>t("label",{for:"category",class:"form-label"},"作者",-1)),ot=a(()=>t("label",{for:"editor1",class:"form-label"},"文章描述",-1)),st=a(()=>t("label",{for:"content",class:"form-label"},"球員內容",-1)),lt=a(()=>t("hr",null,null,-1)),it={class:"form-check"},at=a(()=>t("label",{class:"form-check-label",for:"isPublic"}," 是否啟用 ",-1)),nt={class:"modal-footer"},dt=a(()=>t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function rt(s,o,i,n,e,d){const y=u("el-date-picker"),h=u("ckeditor");return p(),m("div",B,[t("div",N,[t("div",E,[A,t("div",R,[t("div",O,[t("div",j,[t("div",z,[H,_(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":o[0]||(o[0]=l=>e.tempStory.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[f,e.tempStory.imageUrl]])]),t("div",q,[t("label",J,[M("或 上傳圖片 "),t("i",{class:w([{"d-none":!e.Loading_small},"fas fa-spinner fa-spin"])},null,2)]),t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:o[1]||(o[1]=(...l)=>d.uploadFile&&d.uploadFile(...l))},null,544)]),t("img",{class:"of-cover op-top w-100",style:{},src:e.tempStory.imageUrl,alt:e.tempStory.name},null,8,W)]),t("div",Y,[t("div",G,[t("div",K,[Q,c(y,{modelValue:e.create_at,"onUpdate:modelValue":o[2]||(o[2]=l=>e.create_at=l),type:"datetime",placeholder:"Select date and time",shortcuts:e.shortcuts},null,8,["modelValue","shortcuts"])]),t("div",null,[X,_(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[3]||(o[3]=l=>e.tempStory.title=l),placeholder:"請輸入標題"},null,512),[[f,e.tempStory.title]])]),t("div",Z,[t("div",tt,[et,_(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":o[4]||(o[4]=l=>e.tempStory.author=l),placeholder:"請輸入分類"},null,512),[[f,e.tempStory.author]])])]),t("div",null,[ot,c(h,{editor:e.editor,modelValue:e.tempStory.description,"onUpdate:modelValue":o[5]||(o[5]=l=>e.tempStory.description=l),config:e.editorConfig},null,8,["editor","modelValue","config"])]),t("div",null,[st,c(h,{editor:e.editor,modelValue:e.tempStory.content,"onUpdate:modelValue":o[6]||(o[6]=l=>e.tempStory.content=l),config:e.editorConfig},null,8,["editor","modelValue","config"])]),lt,t("div",null,[t("div",it,[_(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=l=>e.tempStory.isPublic=l),"true-value":!0,"false-value":!1,id:"isPublic"},null,512),[[k,e.tempStory.isPublic]]),at])])])])])]),t("div",nt,[dt,t("button",{type:"button",class:"btn btn-nbaBlue",onClick:o[8]||(o[8]=l=>s.$emit("update-story",e.tempStory))}," 確認 ")])])])],512)}const ct=g(F,[["render",rt],["__scopeId","data-v-e7607e83"]]);const pt={components:{StoryModal:ct,DelModal:V,Pagination:I},data(){return{storyList:[],pagination:{},tempStory:{},isNew:!1,isLoading:!1}},created(){this.getStoryList()},methods:{...$(P,["pushMessage"]),getStoryList(s=1){const o=`https://vue3-course-api.hexschool.io/api/william-api/admin/articles/?page=${s}`;this.isLoading=!0,this.$http.get(o).then(i=>{this.isLoading=!1,i.data.success&&(this.storyList=i.data.articles,this.pagination=i.data.pagination)})},openModal(s,o){if(s)this.tempStory={};else{this.isLoading=!0;const n=`https://vue3-course-api.hexschool.io/api/william-api/admin/article/${o}`;this.$http.get(n).then(e=>{e.data.success&&(this.tempStory=e.data.article,this.isLoading=!1)})}this.isNew=s,this.$refs.storyModal.showModal()},updateStory(s){this.tempStory=s;let o="https://vue3-course-api.hexschool.io/api/william-api/admin/article",i="post";this.isNew||(o=`https://vue3-course-api.hexschool.io/api/william-api/admin/article/${s.id}`,i="put");const n=this.$refs.storyModal;this.$http[i](o,{data:this.tempStory}).then(e=>{n.hideModal(),e.data.success?(this.getStoryList(),this.pushMessage(e,"更新")):this.pushMessage(e,"更新")})},openDelStoryModal(s){this.tempStory={...s},this.$refs.delModal.showModal()},delStory(){const s=`https://vue3-course-api.hexschool.io/api/william-api/admin/article/${this.tempStory.id}`;this.$http.delete(s).then(o=>{this.pushMessage(o,o.data.message),this.$refs.delModal.hideModal(),this.getStoryList()})}}},mt={class:"w-100"},ut={class:"text-end mt-3"},ht={class:"table mt-4"},_t=t("thead",null,[t("tr",null,[t("th",{class:"d-md-table-cell d-none",width:"120"},"日期"),t("th",{width:"120"},"標題"),t("th",{class:"d-md-table-cell d-none",width:"120"},"作者"),t("th",{class:"d-md-table-cell d-none",width:"120"},"內容"),t("th",{class:"d-md-table-cell d-none",width:"100"},"是否啟用"),t("th",{width:"150"},"編輯")])],-1),yt={class:"d-md-table-cell d-none"},ft={class:"d-md-table-cell d-none"},bt=["innerHTML"],gt={class:"d-md-table-cell d-none"},St={key:0,class:"text-success"},vt={key:1,class:"text-muted"},xt={class:"text-center"},Mt={class:"btn-group"},wt=["onClick"],kt=["onClick"];function Lt(s,o,i,n,e,d){const y=u("LoadingMask"),h=u("Pagination"),l=u("StoryModal"),S=u("DelModal");return p(),m("div",mt,[c(y,{active:e.isLoading},null,8,["active"]),t("div",ut,[t("button",{class:"btn btn-nbaBlue",type:"button",onClick:o[0]||(o[0]=r=>d.openModal(!0,null))}," 新增文章 ")]),t("table",ht,[_t,t("tbody",null,[(p(!0),m(D,null,T(e.storyList,r=>(p(),m("tr",{key:r.id},[t("td",yt,b(s.$filters.dateAndTime(r.create_at)),1),t("td",null,b(r.title),1),t("td",ft,b(r.author),1),t("td",{class:"d-md-inline-block d-none multiline-ellipsis overflow-hidden",innerHTML:r.description},null,8,bt),t("td",gt,[r.isPublic?(p(),m("span",St,"啟用")):(p(),m("span",vt,"未啟用"))]),t("td",xt,[t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-nbaBlue btn-sm",onClick:v=>d.openModal(!1,r.id)}," 編輯 ",8,wt),t("button",{type:"button",class:"btn btn-outline-nbaRed btn-sm",onClick:v=>d.openDelStoryModal(r)}," 刪除 ",8,kt)])])]))),128))])]),c(h,{pages:e.pagination,onEmitPages:d.getStoryList},null,8,["pages","onEmitPages"]),c(l,{ref:"storyModal",story:e.tempStory,onUpdateStory:d.updateStory},null,8,["story","onUpdateStory"]),c(S,{item:e.tempStory,ref:"delModal",onDelItem:d.delStory},null,8,["item","onDelItem"])])}const Tt=g(pt,[["render",Lt]]);export{Tt as default};
