import{P as b}from"./Pagination-47690327.js";import{_ as p,r as c,o as l,c as a,d as h,w as m,f as t,t as n,g as v,k as w,p as x,i as f,s as L}from"./index-9926fd6b.js";const O={components:{Pagination:b},data(){return{orders:[],state:"",pagination:{},isLoading:!1,order:[],paid_date:null,create_at:null}},created(){this.getOrders()},mounted(){},methods:{querySearch(e){const s=this.orders;return e?this.createFilter(e):s},createFilter(e){return this.orders.filter(s=>s.id.toLowerCase().includes(e.toLowerCase()))},handleSelect(e){this.isLoading=!0;const s=`https://vue3-course-api.hexschool.io/api/william-api/order/${e.id}`;this.$http.get(s).then(r=>{r.data.success&&(this.order=r.data.order,this.paid_date=new Date(this.order.paid_date*1e3).toLocaleString(),this.create_at=new Date(this.order.create_at*1e3).toLocaleString(),this.isLoading=!1,this.querySearch(!1))})},getOrders(e=1){this.currentPage=e;const s=`https://vue3-course-api.hexschool.io/api/william-api/orders?page=${e}`;this.isLoading=!0,this.$http.get(s,this.tempProduct).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.isLoading=!1})},payOrder(e){const s=`https://vue3-course-api.hexschool.io/api/william-api/pay/${e.id}`;this.$http.post(s).then(r=>{r.data.success&&(this.handleSelect(e),this.getOrders())})}}},S={class:"p-2 el-autocomplete-list"},k={class:"d-flex justify-content-between"},P={class:"name"},A={class:"name d-md-table-cell d-none"},M={class:"d-flex gap-4"},V={class:"addr text-danger"},C={key:0},D={key:1,class:"text-success"},B={class:"table align-middle"},E=t("thead",null,[t("th",null,"品名"),t("th",null,"數量"),t("th",{width:"100",class:"text-start"},"單價")],-1),N={class:"text-start"},j=t("td",{colspan:"2",class:"text-end"},"總計",-1),q={class:"text-end"},F={class:"table"},I=t("th",{width:"100"},"訂單時間",-1),T=t("th",{width:"100"},"Email",-1),U=t("th",null,"姓名",-1),z=t("th",null,"電話",-1),G=t("th",null,"地址",-1),H=t("th",null,"付款狀態",-1),J={key:0},K={key:1,class:"text-success"},Q={key:0},R=t("th",null,"付款時間",-1),W={key:0,class:"text-end"},X=t("button",{class:"btn btn-danger"},"pay now",-1),Y=[X],Z={key:1,class:"text-end"},tt=t("button",{class:"btn btn-outline-primary"},"get other thing!",-1);function et(e,s,r,g,o,d){const u=c("Loading"),_=c("el-autocomplete"),y=c("router-link"),$=c("Pagination");return l(),a("div",null,[h(u,{active:o.isLoading},null,8,["active"]),h(_,{"popper-class":"my-autocomplete",class:"my-autocomplete-self",modelValue:o.state,"onUpdate:modelValue":s[0]||(s[0]=i=>o.state=i),"fetch-suggestions":d.querySearch,placeholder:"input order ID",onSelect:d.handleSelect},{default:m(({item:i})=>[t("div",S,[t("div",k,[t("div",P,n(i.id),1),t("div",A,n(e.$filters.dateAndTime(i.create_at)),1)]),t("div",M,[t("span",V,"$"+n(e.$filters.currency(i.total)),1),t("div",null,[i.is_paid?(l(),a("span",D,"付款完成")):(l(),a("span",C,"尚未付款"))])])])]),_:1},8,["modelValue","fetch-suggestions","onSelect"]),o.order.length!==0?(l(),a("form",{key:0,class:"w-100 my-5",onSubmit:s[1]||(s[1]=v(i=>d.payOrder(o.order),["prevent"]))},[t("table",B,[E,t("tbody",null,[(l(!0),a(w,null,x(o.order.products,i=>(l(),a("tr",{key:i.id},[t("td",null,n(i.product.title),1),t("td",null,n(i.qty)+"/"+n(i.product.unit),1),t("td",N,"$ "+n(e.$filters.currency(Math.round(i.final_total))),1)]))),128))]),t("tfoot",null,[t("tr",null,[j,t("td",q,"$ "+n(e.$filters.currency(Math.round(o.order.total))),1)])])]),t("table",F,[t("tbody",null,[t("tr",null,[I,t("td",null,n(o.create_at),1)]),t("tr",null,[T,t("td",null,n(o.order.user.email),1)]),t("tr",null,[U,t("td",null,n(o.order.user.name),1)]),t("tr",null,[z,t("td",null,n(o.order.user.tel),1)]),t("tr",null,[G,t("td",null,n(o.order.user.address),1)]),t("tr",null,[H,t("td",null,[o.order.is_paid?(l(),a("span",K,"付款完成")):(l(),a("span",J,"尚未付款"))])]),o.order.is_paid?(l(),a("tr",Q,[R,t("td",null,n(o.paid_date),1)])):f("",!0)])]),o.order.is_paid===!1?(l(),a("div",W,Y)):(l(),a("div",Z,[h(y,{to:"/"},{default:m(()=>[tt]),_:1})]))],32)):f("",!0),h($,{pages:o.pagination,onEmitPages:d.getOrders},null,8,["pages","onEmitPages"])])}const st=p(O,[["render",et]]),ot={data(){return{ordersLength:null,tempPage:1,ordersAll:[],pagination:{}}},created(){this.getOrders(),this.getOrdersAll()},methods:{getOrders(e=1){this.currentPage=e;const s=`https://vue3-course-api.hexschool.io/api/william-api/orders?page=${e}`;this.$http.get(s,this.tempProduct).then(r=>{this.ordersLength=r.data.orders.length,this.pagination=r.data.pagination})},getOrdersAll(){const e=`https://vue3-course-api.hexschool.io/api/william-api/admin/orders?page=${this.tempPage}`;this.$http.get(e,this.tempProduct).then(s=>{this.ordersAll=this.ordersAll.concat(s.data.orders),this.tempPage<this.pagination.total_pages?(this.tempPage++,this.getOrdersAll(),this.ordersLength=this.ordersAll.length):console.log("getOrdersAll,random success",new Date(this.ordersAll[11].create_at*1e3).toISOString().split("T")[0])})}}},nt={class:"list-group"},rt=t("li",{class:"list-group-item d-flex justify-content-between align-items-center"}," Information ",-1),it={class:"list-group-item d-flex justify-content-between align-items-center"},lt={class:"badge bg-primary rounded-pill"};function at(e,s,r,g,o,d){return l(),a("div",null,[t("ul",nt,[rt,t("li",it,[L(" Order List "),t("span",lt,n(o.ordersLength),1)])])])}const dt=p(ot,[["render",at]]),ct={components:{MemberOrders:st,MemberSide:dt}},ht={class:"container"},ut={class:"row mt-5 gap-3 gap-md-0"};function _t(e,s,r,g,o,d){const u=c("MemberSide"),_=c("MemberOrders");return l(),a("div",ht,[t("div",ut,[h(u,{class:"col-md-2"}),h(_,{class:"col-md-10"})])])}const mt=p(ct,[["render",_t]]);export{mt as default};
