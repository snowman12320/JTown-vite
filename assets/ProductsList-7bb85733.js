import{m as u,b as g,_ as L,G as v,E as w,u as y,l as b,r as x,o as n,c as d,f as t,j as p,I as k,q as c,k as z,p as B,t as m,d as P,w as S,x as h,i as $,v as F,H as T}from"./index-9926fd6b.js";const A={data(){return{isLoading_small:!1,statusBtn_car:{loadingItem:""},products:[],Filtered:[],page:1,pagination:{},productsList_hight:0,selectSort:"0",setClass:!1,productSize_list:"",productSize_item:"",addToCart_item_id:null}},props:["childClass"],mounted(){this.productsList_hight=this.$refs.productsList_hight.offsetHeight;//! 在mounted定義會是零，但不定義會在其他頁報錯
window.addEventListener("scroll",this.handleScroll)},created(){this.getProducts(),this.getFiltered();//! 取得全域搜尋資料
},watch:{toast:{handler(){this.$toast(this.toast.res,this.toast.info)},deep:!0},notLogin(s){s&&this.$swal.fire({title:"Login or Sign up first.",icon:"warning",showCloseButton:!1,showCancelButton:!1,focusConfirm:!0,confirmButtonText:"Login",confirmButtonAriaLabel:"Thumbs up, great!"}).then(o=>{o.isConfirmed&&this.$router.push("/login")})},productSize_list(){this.addToCart(this.addToCart_item_id,1,!1)}},computed:{...u(v,["isLoading"]),...u(w,["statusBtn","filteredProducts","favoriteIds","toast","notLogin"]),...u(y,["cacheSearch","cacheCategory","filterCheck"]),...u(b,["isLogin"]),filteredData(){let s=[];if(!this.$route.path.includes("products-content")&&!this.$route.path.includes("products-item"))s=this.products;else{s=this.Filtered.filter(i=>(!this.cacheSearch||i.title.toLowerCase().includes(this.cacheSearch))&&(!this.cacheCategory||i.category.toLowerCase().includes(this.cacheCategory.trim().toLowerCase()))),s.length===0&&(s=this.products),!this.cacheCategory&&!this.cacheSearch&&(s=this.products);const o={999:i=>i.price<999,2999:i=>i.price>=999&&i.price<=2999,3e3:i=>i.price>=3e3,default:()=>!0}[this.filterCheck||"default"],a={Low:(i,e)=>i.price-e.price,Height:(i,e)=>e.price-i.price,AZ:(i,e)=>i.title.localeCompare(e.title),ZA:(i,e)=>e.title.localeCompare(i.title),default:()=>0}[this.selectSort||"default"];s=s.filter(o).sort(a)}return s}},methods:{...g(v,["getCart"]),...g(w,["getFavorite","updateFavorite"]),...g(y,["getProduct_item"]),addToCart(s,o=1,a){if(!this.isLogin)this.$swal.fire({title:"Login or Sign up first.",icon:"warning",showCloseButton:!1,showCancelButton:!1,focusConfirm:!0,confirmButtonText:"Login",confirmButtonAriaLabel:"Thumbs up, great!"}).then(i=>{i.isConfirmed&&this.$router.push("/login")});else if(!this.productSize_list&&!this.productSize_item)this.$swal.fire("Please","Size must be selected.","warning");else{this.statusBtn_car.loadingItem=s;const i="https://vue3-course-api.hexschool.io/api/william-api/cart",e={product_id:s,qty:o};this.$http.post(i,{data:e}).then(()=>{this.getCart(),this.statusBtn_car.loadingItem="",this.$toast("success","add to cart."),a&&(this.$router.push("/cart-view/cart-list"),this.getCart())})}},handleScroll(){//! 這邊定義會在切換router時，取不到dom（可能生命週期沒有重整吧）
window.scrollY>this.productsList_hight-300&&this.pushProducts()},getFiltered(){const s="https://vue3-course-api.hexschool.io/api/william-api/products/all";this.$http.get(s).then(o=>{o.data.success&&(this.Filtered=o.data.products)})},getProducts(s=1){const o=`https://vue3-course-api.hexschool.io/api/william-api/products/?page=${s}`;this.$http.get(o).then(a=>{a.data.success&&(this.products=a.data.products,this.pagination=a.data.pagination)})},pushProducts(){//! 要用this.isLoading阻擋，避免讀取api間隔，持續捲動導致重複讀取資料
if(!this.isLoading_small&&this.pagination.has_next){this.isLoading_small=!0,this.page++;const s=`https://vue3-course-api.hexschool.io/api/william-api/products/?page=${this.page}`;this.$http.get(s).then(o=>{if(o.data.success){this.pagination=o.data.pagination,this.products=this.products.concat(o.data.products);//! 成功讀取分頁數後，才能關閉載入，進行下次資料儲存，否則會重複儲存
this.isLoading_small=!1}})}},goToProduct(s){this.getProduct_item(s)}}},I={class:"product_list"},V=t("label",{for:"Sort",class:"form-label mb-0"},"Sort by：",-1),H=T('<option class="fs-6" value="0" selected>Relevance</option><option class="fs-6" value="AZ">Name - AZ</option><option class="fs-6" value="ZA">Name - ZA</option><option class="fs-6" value="Low">Price - Low to Height</option><option class="fs-6" value="Height">Price - Height to Low</option>',5),M=[H],Z=t("hr",{class:"py-3"},null,-1),D={ref:"productsList_hight"},N={key:0,class:"row row-cols-2 row-cols-lg-5 g-2 g-md-4 mb-7"},U={class:"col overflow-hidden"},j={class:"fw-light",style:{"font-size":"10px"}},E=["onClick"],X={class:"text-white text-center"},R={class:"position-relative border border-white rounded-3 px-2 py-3 d-flex justify-content-around m-2",style:{"backdrop-filter":"blur(5px)"}},q=["onClick"],G={class:"d-flex justify-content-center w-100 mx-auto gap-1",style:{"z-index":"2"}},O={class:"slanted-div"},Y=t("label",{style:{cursor:"not-allowed"},disabled:"",class:"form-check-label border border-secondary text-secondary fs-6 px-2 py-1",for:"list_XL"}," xL ",-1),J=["onClick"],K={key:0,class:"text-center d-flex align-items-center justify-content-center position-absolute top-0 start-0 end-0 bottom-0"},Q=t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),W=[Q],tt=["src","alt"],et={key:1},st=t("p",{class:"text-secondary text-center display-6"},"Sorry, the product list is empty.",-1),ot=[st],it={class:"text-center"},rt={class:"spinner-grow text-warning",role:"status"},lt=t("span",{class:"visually-hidden"},"Loading...",-1),at=[lt];function ct(s,o,a,i,e,f){const C=x("el-popover");return n(),d("div",I,[t("div",{class:c(["mb-3 d-flex justify-content-end align-items-center",a.childClass])},[V,p(t("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>e.selectSort=r),class:"form-select form-select-lg rounded-3 px-1 py-2 fs-6",style:{width:"250px"},id:"Sort"},M,512),[[k,e.selectSort]])],2),Z,t("div",D,[f.filteredData.length>0?(n(),d("div",N,[(n(!0),d(z,null,B(f.filteredData,(r,_)=>(n(),d("div",{key:r.id},[t("div",U,[t("div",{class:c(["card w-100 position-relation newproduct_img",{"overflow-hidden":e.setClass===_}]),"data-num":"1"},[t("div",{class:c(["newproduct_cloth p-1",{newproduct_cloth_set:e.setClass===_}]),ref_for:!0,ref:"newproduct_cloth"},[t("h6",j,m(r.category),1),t("h5",{class:"fs-5 text-center",onClick:l=>f.goToProduct(r.id)},m(r.title),9,E),t("h6",X,"$ "+m(s.$filters.currency(r.price)),1),t("div",R,[t("i",{onClick:l=>s.updateFavorite(r.id),class:c([{"text-danger":s.isLogin&&s.favoriteIds.indexOf(r.id)!==-1},"fa fa-heart fs-4"])},null,10,q),P(C,{placement:"top",title:"SIZE：",width:200,trigger:"click",onHide:o[5]||(o[5]=l=>e.setClass=!1),onShow:l=>e.setClass=_,"popper-class":"product_list_el-popover"},{reference:S(()=>[t("i",{onClick:l=>e.addToCart_item_id=r.id,class:"fa fa-cart-plus text-white fs-4"},null,8,J)]),default:S(()=>[t("div",G,[t("div",null,[p(t("input",{value:"S","onUpdate:modelValue":o[1]||(o[1]=l=>e.productSize_list=l),class:"form-check-input d-none",type:"radio",name:"size",id:"list_S"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="S"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_S"}," S ",2)]),t("div",null,[p(t("input",{value:"M","onUpdate:modelValue":o[2]||(o[2]=l=>e.productSize_list=l),class:"form-check-input d-none",type:"radio",name:"size",id:"list_M"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="M"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_M"}," M ",2)]),t("div",null,[p(t("input",{value:"L","onUpdate:modelValue":o[3]||(o[3]=l=>e.productSize_list=l),class:"form-check-input d-none",type:"radio",name:"size",id:"list_L"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="L"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_L"}," L ",2)]),t("div",O,[p(t("input",{disabled:"",value:"XL","onUpdate:modelValue":o[4]||(o[4]=l=>e.productSize_list=l),class:"form-check-input d-none",type:"radio",name:"size",id:"list_XL"},null,512),[[h,e.productSize_list]]),Y])])]),_:2},1032,["onShow"]),s.statusBtn.loadingItem===r.id||e.statusBtn_car.loadingItem===r.id?(n(),d("div",K,W)):$("",!0)])],2),t("img",{"data-num":"1",height:"312",width:"312",class:"card-img of-cover op-top",src:r.imageUrl,alt:r.title},null,8,tt)],2)])]))),128))])):(n(),d("div",et,ot))],512),t("div",it,[p(t("div",rt,at,512),[[F,e.isLoading_small]])])])}const dt=L(A,[["render",ct]]);export{dt as P};
