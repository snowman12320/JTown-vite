import{_,J as M,o as i,c as p,f as o,j as c,D as u,K as $,a3 as g,b as x,r as h,d as r,k as y,p as k,t as m,y as w,z as D}from"./index-9926fd6b.js";import{m as L}from"./messageStore-ef06d3f8.js";const U={name:"couponModal",emits:["update-coupon"],mixins:[M],data(){return{tempCoupon:{},due_date:""}},props:{coupon:{}},watch:{coupon(){this.tempCoupon=this.coupon,[this.due_date]=this.$filters.dateOrTime(this.tempCoupon.due_date)},due_date(){this.tempCoupon.due_date=this.$filters.dateToSeconds(this.due_date)}}},V={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog",role:"document"},I={class:"modal-content mt-10"},N=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},T={class:"mb-3"},j=o("label",{for:"title"},"標題",-1),O={class:"mb-3"},z=o("label",{for:"coupon_code"},"優惠碼",-1),A={class:"mb-3"},E=o("label",{for:"due_date"},"到期日",-1),F={class:"mb-3"},J=o("label",{for:"price"},"折扣百分比",-1),K={class:"mb-3"},P={class:"form-check"},R=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),q={class:"modal-footer"},G=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function H(t,e,d,b,s,a){return i(),p("div",V,[o("div",B,[o("div",I,[N,o("div",S,[o("div",T,[j,c(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[u,s.tempCoupon.title]])]),o("div",O,[z,c(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=n=>s.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[u,s.tempCoupon.code]])]),o("div",A,[E,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>s.due_date=n)},null,512),[[u,s.due_date]])]),o("div",F,[J,c(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=n=>s.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[u,s.tempCoupon.percent,void 0,{number:!0}]])]),o("div",K,[o("div",P,[c(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[$,s.tempCoupon.is_enabled]]),R])])]),o("div",q,[G,o("button",{type:"button",class:"btn btn-nbaBlue",onClick:e[5]||(e[5]=n=>t.$emit("update-coupon",s.tempCoupon))}," 更新優惠券 ")])])])],512)}const Q=_(U,[["render",H]]);const W={components:{CouponModal:Q,DelModal:g},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1}},props:{config:Object},created(){console.clear(),this.getCoupons()},methods:{...x(L,["pushMessage"]),openCouponModal(t,e){this.isNew=t,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...e},this.$refs.couponModal.showModal()},openDelCouponModal(t){this.tempCoupon={...t},this.$refs.delModal.showModal()},getCoupons(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/william-api/admin/coupons";this.$http.get(t,this.tempProduct).then(e=>{this.coupons=e.data.coupons,this.isLoading=!1})},updateCoupon(t){if(this.isNew){const e="https://vue3-course-api.hexschool.io/api/william-api/admin/coupon";this.$http.post(e,{data:t}).then(d=>{console.log(d,t),this.pushMessage(d,"新增優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()})}else{const e=`https://vue3-course-api.hexschool.io/api/william-api/admin/coupon/${this.tempCoupon.id}`;this.$http.put(e,{data:this.tempCoupon}).then(d=>{this.pushMessage(d,"新增優惠券"),this.getCoupons(),this.$refs.couponModal.hideModal()})}},delCoupon(){const t=`https://vue3-course-api.hexschool.io/api/william-api/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(t).then(e=>{this.pushMessage(e,"刪除優惠券"),this.$refs.delModal.hideModal(),this.getCoupons()})}}},X=t=>(w("data-v-1ca0797f"),t=t(),D(),t),Y={class:"w-100"},Z={class:"text-end mt-4"},oo={class:"table mt-4"},eo=X(()=>o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",{class:"d-md-table-cell d-none"},"折扣百分比"),o("th",{class:"d-md-table-cell d-none"},"到期日"),o("th",{class:"d-md-table-cell d-none"},"是否啟用"),o("th",{width:"150"},"編輯")])],-1)),to={class:"d-md-table-cell d-none"},so={class:"d-md-table-cell d-none"},no={class:"d-md-table-cell d-none"},lo={key:0,class:"text-success"},ao={key:1,class:"text-muted"},io={class:"btn-group"},po=["onClick"],co=["onClick"];function uo(t,e,d,b,s,a){const n=h("Loading"),C=h("couponModal"),f=h("DelModal");return i(),p("div",Y,[r(n,{active:s.isLoading},null,8,["active"]),o("div",Z,[o("button",{class:"btn btn-nbaBlue",onClick:e[0]||(e[0]=l=>a.openCouponModal(!0))},"新增優惠券")]),o("table",oo,[eo,o("tbody",null,[(i(!0),p(y,null,k(s.coupons,l=>(i(),p("tr",{key:l.id},[o("td",null,m(l.title),1),o("td",to,m(l.percent)+"%",1),o("td",so,m(t.$filters.date(l.due_date)),1),o("td",no,[l.is_enabled===1?(i(),p("span",lo,"啟用")):(i(),p("span",ao,"未啟用"))]),o("td",null,[o("div",io,[o("button",{class:"btn btn-outline-nbaBlue btn-sm",onClick:v=>a.openCouponModal(!1,l)}," 編輯 ",8,po),o("button",{class:"btn btn-outline-nbaRed btn-sm",onClick:v=>a.openDelCouponModal(l)}," 刪除 ",8,co)])])]))),128))])]),r(C,{coupon:s.tempCoupon,ref:"couponModal",onUpdateCoupon:a.updateCoupon},null,8,["coupon","onUpdateCoupon"]),r(f,{item:s.tempCoupon,ref:"delModal",onDelItem:a.delCoupon},null,8,["item","onDelItem"])])}const mo=_(W,[["render",uo],["__scopeId","data-v-1ca0797f"]]);export{mo as default};
