import{_ as y,J as S,o as n,c as i,f as e,t as d,i as k,k as g,p as O,a3 as C,b as L,r as _,d as m,j as p,D,I as A,x as v,q as b,v as I,L as V,y as U,z as B}from"./index-f9d242ac.js";import{P as E}from"./Pagination-6b6780b9.js";import{m as T}from"./messageStore-2b7ed7f6.js";const F={name:"orderModal",emits:["update-paid"],mixins:[S],data(){return{status:{},modal:"",tempOrder:{}}},props:{order:{type:Object,default(){return{}}}},watch:{order(){this.tempOrder=this.order}},methods:{setPaid(){this.tempOrder.is_paid=!this.tempOrder.is_paid,this.$emit("update-paid",this.tempOrder)}}},H={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},j={class:"modal-content border-0"},q=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},z={class:"row"},J={class:"col-md-4"},G=e("h3",null,"用戶資料",-1),K={class:"table"},Q={key:0},W=e("th",{style:{width:"100px"}},"姓名",-1),X=e("th",null,"Email",-1),Y=e("th",null,"電話",-1),Z=e("th",null,"地址",-1),ee={class:"col-md-8"},te=e("h3",null,"訂單細節",-1),se={class:"table"},le=e("th",{style:{width:"100px"}},"訂單編號",-1),oe=e("th",null,"下單時間",-1),de=e("th",null,"付款時間",-1),ne={key:0},ie={key:1},re=e("th",null,"付款狀態",-1),ae={key:0,class:"text-success"},ce={key:1,class:"text-muted"},he=e("th",null,"總金額",-1),ue=e("h3",null,"選購商品",-1),pe={class:"table"},_e=e("thead",null,[e("tr")],-1),me={class:"text-end"},fe={class:"modal-footer"},be=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1);function ge(s,l,r,f,t,a){return n(),i("div",H,[e("div",N,[e("div",j,[q,e("div",R,[e("div",z,[e("div",J,[G,e("table",K,[t.tempOrder.user?(n(),i("tbody",Q,[e("tr",null,[W,e("td",null,d(t.tempOrder.user.name),1)]),e("tr",null,[X,e("td",null,d(t.tempOrder.user.email),1)]),e("tr",null,[Y,e("td",null,d(t.tempOrder.user.tel),1)]),e("tr",null,[Z,e("td",null,d(t.tempOrder.user.address),1)])])):k("",!0)])]),e("div",ee,[te,e("table",se,[e("tbody",null,[e("tr",null,[le,e("td",null,d(t.tempOrder.id),1)]),e("tr",null,[oe,e("td",null,d(s.$filters.dateAndTime(t.tempOrder.create_at)),1)]),e("tr",null,[de,e("td",null,[t.tempOrder.paid_date?(n(),i("span",ne,d(s.$filters.dateAndTime(t.tempOrder.paid_date)),1)):(n(),i("span",ie))])]),e("tr",null,[re,e("td",null,[t.tempOrder.is_paid?(n(),i("strong",ae,"已付款")):(n(),i("span",ce,"尚未付款"))])]),e("tr",null,[he,e("td",null,d(s.$filters.currency(t.tempOrder.total)),1)])])]),ue,e("table",pe,[_e,e("tbody",null,[(n(!0),i(g,null,O(t.tempOrder.products,h=>(n(),i("tr",{key:h.id},[e("th",null,d(h.product.title),1),e("td",null,d(h.qty)+" / "+d(h.product.unit),1),e("td",me,d(s.$filters.currency(h.final_total)),1)]))),128))])])])])]),e("div",fe,[be,e("button",{type:"button",class:"btn btn-nbaBlue",onClick:l[0]||(l[0]=(...h)=>a.setPaid&&a.setPaid(...h))},"更新付款")])])])],512)}const Oe=y(F,[["render",ge]]);const ve={components:{Pagination:E,DelModal:C,OrderModal:Oe},data(){return{orders:[],isNew:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1,search:"",filterPaid:"default",ordersAll:[],tempPage:1,selectSort:"default"}},created(){this.getOrders(),this.getOrdersAll()},computed:{filterOrder(){if(!this.search&&this.filterPaid.includes("default")&&this.selectSort.includes("default"))return this.orders;{//! 無法先排序 > 因為上面擋住了！！！( Irregular whitespace not allowed  no-irregular-whitespace)
return this.ordersAll.filter(s=>this.filterOrderByIdAndDate(s)).filter(this.getFilterPaid()).sort(this.getSelectSort())}}},methods:{...L(T,["pushMessage"]),filterOrderByIdAndDate(s){return s.id.toLowerCase().includes(this.search.toLowerCase().trim())||this.$filters.date(s.create_at).match(this.search.trim())},getFilterPaid(){return{unpaid:l=>l.is_paid===!1,default:()=>!0}[this.filterPaid||"default"]},getSelectSort(){return{Low:(l,r)=>new Date(l.create_at*1e3)-new Date(r.create_at*1e3),Height:(l,r)=>new Date(r.create_at*1e3)-new Date(l.create_at*1e3),default:()=>0}[this.selectSort||"default"]},getOrders(s=1){this.currentPage=s;const l=`https://vue3-course-api.hexschool.io/api/william-api/admin/orders?page=${s}`;this.isLoading=!0,this.$http.get(l,this.tempProduct).then(r=>{this.orders=r.data.orders,this.pagination=r.data.pagination,this.isLoading=!1})},openModal(s,l){this.tempOrder={...l},this.isNew=s,this.$refs.orderModal.showModal()},openDelOrderModal(s){this.tempOrder={...s},s.title||(this.tempOrder.title=this.tempOrder.id),this.$refs.delModal.showModal()},updatePaid(s){this.isLoading=!0;const l=`https://vue3-course-api.hexschool.io/api/william-api/admin/order/${s.id}`,r={is_paid:s.is_paid};this.$http.put(l,{data:r}).then(f=>{this.getOrders(this.currentPage),this.$refs.orderModal.hideModal(),this.isLoading=!1,this.pushMessage(f,"更新付款狀態")})},delOrder(){const s=`https://vue3-course-api.hexschool.io/api/william-api/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(s).then(l=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage),this.pushMessage(l,"delete")})},getOrdersAll(){const s=`https://vue3-course-api.hexschool.io/api/william-api/admin/orders?page=${this.tempPage}`;this.$http.get(s,this.tempProduct).then(l=>{if(this.ordersAll=this.ordersAll.concat(l.data.orders),this.tempPage<this.pagination.total_pages)this.tempPage++,this.getOrdersAll();else{//! 須返回某個數值，不然會噴錯
console.info("getOrdersAll,random success",new Date(this.ordersAll[11].create_at*1e3).toISOString().split("T")[0])}})},delAllOrder(){const s="https://vue3-course-api.hexschool.io/api/william-api/admin/order/allll";this.isLoading=!0,this.$http.delete(s).then(l=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage),this.pushMessage(l,"delete all")})}}},c=s=>(U("data-v-54e982a3"),s=s(),B(),s),ye={class:"w-100"},ke={class:"d-flex justify-content-end"},Me={class:"mt-3 d-flex flex-column flex-md-row gap-1 flex-nowrap"},we={class:"flex-shrink-0"},xe=c(()=>e("option",{value:"default",selected:""},"to sift",-1)),Pe=c(()=>e("option",{value:"unpaid"},"no paid",-1)),$e=[xe,Pe],Se={class:"table mt-4"},Ce=c(()=>e("span",null,"購買時間",-1)),Le={class:"form-check"},De=["value","checked"],Ae=c(()=>e("i",{class:"bi bi-caret-up-fill"},null,-1)),Ie=[Ae],Ve={class:"form-check"},Ue=["value","checked"],Be=c(()=>e("i",{class:"bi bi-caret-down-fill"},null,-1)),Ee=[Be],Te=c(()=>e("th",null,"訂單編號",-1)),Fe=c(()=>e("th",{class:"d-md-table-cell d-none"},"姓名",-1)),He=c(()=>e("th",{class:"d-md-table-cell d-none"},"Email",-1)),Ne=c(()=>e("th",{class:"d-md-table-cell d-none"},"購買款項",-1)),je=c(()=>e("th",{class:"d-md-table-cell d-none"},"應付金額",-1)),qe=c(()=>e("th",{class:"d-md-table-cell d-none"},"是否付款",-1)),Re=c(()=>e("th",{width:"150"},"編輯",-1)),ze={class:"d-md-table-cell d-none"},Je={class:""},Ge={class:"d-md-table-cell d-none"},Ke={class:"d-md-table-cell d-none"},Qe=["textContent"],We={class:"d-md-table-cell d-none"},Xe={class:"list-unstyled"},Ye={class:"text-right d-md-table-cell d-none"},Ze={class:"d-md-table-cell d-none"},et={class:"form-check form-switch"},tt=["id","onUpdate:modelValue","onChange"],st=["for"],lt={key:0},ot={key:1},dt={class:"btn-group"},nt=["onClick"],it=["onClick"];function rt(s,l,r,f,t,a){const h=_("LoadingMask"),M=_("OrderModal"),w=_("DelModal"),x=_("Pagination");return n(),i("div",ye,[m(h,{active:t.isLoading},null,8,["active"]),e("div",ke,[e("div",Me,[p(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>t.search=o),type:"search",class:"form-control","aria-describedby":"helpId",placeholder:"search order ID / DATE"},null,512),[[D,t.search]]),e("div",we,[p(e("select",{"onUpdate:modelValue":l[1]||(l[1]=o=>t.filterPaid=o),class:"form-select form-select-lg"},$e,512),[[A,t.filterPaid]])]),e("button",{onClick:l[2]||(l[2]=o=>a.openDelOrderModal(s.item={title:"ALL"})),type:"button",class:"btn btn-nbaRed flex-shrink-0"}," Delete ALL ")])]),e("table",Se,[e("thead",null,[e("tr",null,[e("th",{class:"d-flex align-items-center justify-content-around d-md-flex d-none",onClick:l[5]||(l[5]=o=>t.selectSort=t.selectSort==="Height"?"Low":"Height")},[Ce,e("div",null,[e("div",Le,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"3",id:"1","onUpdate:modelValue":l[3]||(l[3]=o=>t.selectSort=o),value:t.selectSort,checked:t.selectSort==="Low"},null,8,De),[[v,t.selectSort]]),e("label",{class:b(["form-check-label",{" text-primary":t.selectSort==="Low"||t.selectSort==="default"}]),for:"1"},Ie,2)]),e("div",Ve,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"3",id:"2","onUpdate:modelValue":l[4]||(l[4]=o=>t.selectSort=o),value:t.selectSort,checked:t.selectSort==="Height"},null,8,Ue),[[v,t.selectSort]]),e("label",{class:b(["form-check-label",{" text-primary":t.selectSort==="Height"||t.selectSort==="default"}]),for:"2"},Ee,2)])])]),Te,Fe,He,Ne,je,qe,Re])]),e("tbody",null,[(n(!0),i(g,null,O(a.filterOrder,(o,P)=>(n(),i("tr",{key:P,class:b({"text-secondary":!o.is_paid})},[e("td",ze,d(s.$filters.dateAndTime(o.create_at)),1),e("td",Je,d(o.id),1),e("td",Ge,d(o.user.name),1),e("td",Ke,[o.user?(n(),i("span",{key:0,textContent:d(o.user.email)},null,8,Qe)):k("",!0)]),e("td",We,[e("ul",Xe,[(n(!0),i(g,null,O(o.products,(u,$)=>(n(),i("li",{key:$},d(u.product.title)+" - 數量："+d(u.qty)+" "+d(u.product.unit),1))),128))])]),e("td",Ye,d(Math.floor(o.total)),1),e("td",Ze,[e("div",et,[p(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":u=>o.is_paid=u,onChange:u=>a.updatePaid(o)},null,40,tt),[[V,o.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${o.id}`},[o.is_paid?(n(),i("span",lt,"已付款")):(n(),i("span",ot,"未付款"))],8,st)])]),e("td",null,[e("div",dt,[e("button",{type:"button",class:"btn btn-outline-nbaBlue btn-sm",onClick:u=>a.openModal(!1,o)}," 檢視 ",8,nt),e("button",{type:"button",class:"btn btn-outline-nbaRed btn-sm",onClick:u=>a.openDelOrderModal(o)}," 刪除 ",8,it)])])],2))),128))])]),m(M,{order:t.tempOrder,ref:"orderModal",onUpdatePaid:a.updatePaid},null,8,["order","onUpdatePaid"]),m(w,{item:t.tempOrder,ref:"delModal",onDelItem:a.delOrder,onDelAll:a.delAllOrder},null,8,["item","onDelItem","onDelAll"]),p(m(x,{pages:t.pagination,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"]),[[I,!t.search&&t.filterPaid==="default"]])])}const ut=y(ve,[["render",rt],["__scopeId","data-v-54e982a3"]]);export{ut as default};
