import{m as u,b as _,_ as C,G as m,E as v,u as w,l as L,r as b,o as n,c as d,f as t,j as p,I as x,q as c,k,p as z,t as g,d as B,w as y,x as h,i as P,v as $,H as F}from"./index-f9d242ac.js";const T={data(){return{isLoading_small:!1,statusBtn_car:{loadingItem:""},products:[],Filtered:[],page:1,pagination:{},productsList_hight:0,selectSort:"0",setClass:!1,productSize_list:"",productSize_item:"",addToCart_item_id:null}},props:["childClass"],mounted(){this.productsList_hight=this.$refs.productsList_hight.offsetHeight;//! 在mounted定義會是零，但不定義會在其他頁報錯
window.addEventListener("scroll",this.handleScroll)},created(){this.getProducts(),this.getFiltered();//! 取得全域搜尋資料
},watch:{toast:{handler(){this.$toast(this.toast.res,this.toast.info)},deep:!0},notLogin(s){s&&this.$swal.fire({title:"Login or Sign up first.",icon:"warning",showCloseButton:!1,showCancelButton:!1,focusConfirm:!0,confirmButtonText:"Login",confirmButtonAriaLabel:"Thumbs up, great!"}).then(i=>{i.isConfirmed&&this.$router.push("/login")})},productSize_list(){this.addToCart(this.addToCart_item_id,1,!1)}},computed:{...u(m,["isLoading"]),...u(v,["statusBtn","filteredProducts","favoriteIds","toast","notLogin"]),...u(w,["cacheSearch","cacheCategory","filterCheck"]),...u(L,["isLogin"]),filteredData(){let s=[];if(!this.$route.path.includes("products-content")&&!this.$route.path.includes("products-item"))s=this.products;else{s=this.Filtered.filter(o=>(!this.cacheSearch||o.title.toLowerCase().includes(this.cacheSearch))&&(!this.cacheCategory||o.category.toLowerCase().includes(this.cacheCategory.trim().toLowerCase()))),s.length===0&&(s=this.products),!this.cacheCategory&&!this.cacheSearch&&(s=this.products);const i={999:o=>o.price<999,2999:o=>o.price>=999&&o.price<=2999,3e3:o=>o.price>=3e3,default:()=>!0}[this.filterCheck||"default"],a={Low:(o,e)=>o.price-e.price,Height:(o,e)=>e.price-o.price,AZ:(o,e)=>o.title.localeCompare(e.title),ZA:(o,e)=>e.title.localeCompare(o.title),default:()=>0}[this.selectSort||"default"];s=s.filter(i).sort(a)}return s}},methods:{..._(m,["getCart"]),..._(v,["getFavorite","updateFavorite"]),..._(w,["getProduct_item"]),addToCart(s,i=1,a){if(!this.isLogin)this.$swal.fire({title:"Login or Sign up first.",icon:"warning",showCloseButton:!1,showCancelButton:!1,focusConfirm:!0,confirmButtonText:"Login",confirmButtonAriaLabel:"Thumbs up, great!"}).then(o=>{o.isConfirmed&&this.$router.push("/login")});else if(!this.productSize_list&&!this.productSize_item)this.$swal.fire("Please","Size must be selected.","warning");else{this.statusBtn_car.loadingItem=s;const o="https://vue3-course-api.hexschool.io/api/william-api/cart",e={product_id:s,qty:i};this.$http.post(o,{data:e}).then(()=>{this.getCart(),this.statusBtn_car.loadingItem="",this.$toast("success","add to cart."),a&&(this.$router.push("/cart-view/cart-list"),this.getCart())})}},handleScroll(){//! 這邊定義會在切換router時，取不到dom（可能生命週期沒有重整吧）
window.scrollY>this.productsList_hight-300&&this.pushProducts()},getFiltered(){const s="https://vue3-course-api.hexschool.io/api/william-api/products/all";this.$http.get(s).then(i=>{i.data.success&&(this.Filtered=i.data.products)})},getProducts(s=1){const i=`https://vue3-course-api.hexschool.io/api/william-api/products/?page=${s}`;this.$http.get(i).then(a=>{a.data.success&&(this.products=a.data.products,this.pagination=a.data.pagination)})},pushProducts(){//! 要用this.isLoading阻擋，避免讀取api間隔，持續捲動導致重複讀取資料
if(!this.isLoading_small&&this.pagination.has_next){this.isLoading_small=!0,this.page++;const s=`https://vue3-course-api.hexschool.io/api/william-api/products/?page=${this.page}`;this.$http.get(s).then(i=>{if(i.data.success){this.pagination=i.data.pagination,this.products=this.products.concat(i.data.products);//! 成功讀取分頁數後，才能關閉載入，進行下次資料儲存，否則會重複儲存
this.isLoading_small=!1}})}},goToProduct(s){this.getProduct_item(s)}}},A={class:"product_list"},I=t("label",{for:"Sort",class:"form-label mb-0"},"Sort by：",-1),V=F('<option class="fs-6" value="0" selected>Relevance</option><option class="fs-6" value="AZ">Name - A to Z</option><option class="fs-6" value="ZA">Name - Z to A</option><option class="fs-6" value="Low">Price - Low to Height</option><option class="fs-6" value="Height">Price - Height to Low</option>',5),H=[V],M=t("hr",{class:"py-3"},null,-1),Z={ref:"productsList_hight"},D={key:0,class:"row row-cols-2 row-cols-lg-5 g-2 g-md-4 mb-7"},N={class:"col overflow-hidden"},U={style:{padding:"1em"}},j={class:"fw-light",style:{"font-size":"14px"}},E=["onClick"],X={class:"text-white text-left"},R={class:"position-relative border border-white rounded-3 px-2 py-3 d-flex justify-content-around m-2",style:{"backdrop-filter":"blur(5px)"}},q=["onClick"],G={class:"d-flex justify-content-center w-100 mx-auto gap-1",style:{"z-index":"2"}},O={class:"slanted-div"},Y=t("label",{style:{cursor:"not-allowed"},disabled:"",class:"form-check-label border border-secondary text-secondary fs-6 px-2 py-1",for:"list_XL"}," xL ",-1),J=["onClick"],K={key:0,class:"text-center d-flex align-items-center justify-content-center position-absolute top-0 start-0 end-0 bottom-0"},Q=t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),W=[Q],tt=["src","alt"],et={key:1},st=t("p",{class:"text-secondary text-center display-6"}," Sorry, the product list is empty. ",-1),it=[st],ot={class:"text-center"},lt={class:"spinner-grow text-warning",role:"status"},rt=t("span",{class:"visually-hidden"},"Loading...",-1),at=[rt];function ct(s,i,a,o,e,f){const S=b("el-popover");return n(),d("div",A,[t("div",{class:c(["mb-3 d-flex justify-content-end align-items-center",a.childClass])},[I,p(t("select",{"onUpdate:modelValue":i[0]||(i[0]=l=>e.selectSort=l),class:"form-select form-select-lg rounded-3 py-2 fs-6",style:{width:"250px"},id:"Sort"},H,512),[[x,e.selectSort]])],2),M,t("div",Z,[f.filteredData.length>0?(n(),d("div",D,[(n(!0),d(k,null,z(f.filteredData,l=>(n(),d("div",{key:l.id},[t("div",N,[t("div",{class:c(["card w-100 position-relation newproduct_img",{"overflow-hidden":e.setClass===l.id}]),"data-num":"1"},[t("div",{class:c(["newproduct_cloth p-1",{newproduct_cloth_set:e.setClass===l.id}]),ref_for:!0,ref:"newproduct_cloth"},[t("div",U,[t("h6",j,g(l.category),1),t("h5",{class:"fs-5 text-left multiline-ellipsis",onClick:r=>f.goToProduct(l.id)},g(l.title),9,E),t("h6",X," $ "+g(s.$filters.currency(l.price)),1)]),t("div",R,[t("i",{onClick:r=>s.updateFavorite(l.id),class:c([{"text-danger":s.isLogin&&s.favoriteIds.indexOf(l.id)!==-1},"fa fa-heart fs-4"])},null,10,q),B(S,{placement:"top",title:"SIZE：",width:200,trigger:"click",onHide:i[5]||(i[5]=r=>e.setClass=!1),onShow:r=>e.setClass=l.id,"popper-class":"product_list_el-popover"},{reference:y(()=>[t("i",{onClick:r=>e.addToCart_item_id=l.id,class:"fa fa-cart-plus text-white fs-4"},null,8,J)]),default:y(()=>[t("div",G,[t("div",null,[p(t("input",{value:"S","onUpdate:modelValue":i[1]||(i[1]=r=>e.productSize_list=r),class:"form-check-input d-none",type:"radio",name:"size",id:"list_S"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="S"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_S"}," S ",2)]),t("div",null,[p(t("input",{value:"M","onUpdate:modelValue":i[2]||(i[2]=r=>e.productSize_list=r),class:"form-check-input d-none",type:"radio",name:"size",id:"list_M"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="M"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_M"}," M ",2)]),t("div",null,[p(t("input",{value:"L","onUpdate:modelValue":i[3]||(i[3]=r=>e.productSize_list=r),class:"form-check-input d-none",type:"radio",name:"size",id:"list_L"},null,512),[[h,e.productSize_list]]),t("label",{style:{cursor:"pointer"},class:c([{"bg-black text-white":e.productSize_list==="L"},"form-check-label border border-secondary text-secondary fs-6 px-2 py-1"]),for:"list_L"}," L ",2)]),t("div",O,[p(t("input",{disabled:"",value:"XL","onUpdate:modelValue":i[4]||(i[4]=r=>e.productSize_list=r),class:"form-check-input d-none",type:"radio",name:"size",id:"list_XL"},null,512),[[h,e.productSize_list]]),Y])])]),_:2},1032,["onShow"]),s.statusBtn.loadingItem===l.id||e.statusBtn_car.loadingItem===l.id?(n(),d("div",K,W)):P("",!0)])],2),t("img",{"data-num":"1",height:"312",width:"312",class:"card-img of-cover op-top",src:l.imageUrl,alt:l.title},null,8,tt)],2)])]))),128))])):(n(),d("div",et,it))],512),t("div",ot,[p(t("div",lt,at,512),[[$,e.isLoading_small]])])])}const dt=C(T,[["render",ct]]);export{dt as P};
